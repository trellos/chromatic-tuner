<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>TUNA</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="icon" href="./favicon.svg" type="image/svg+xml" />
  </head>

  <body>
    <main class="app">
      <header class="app-header">
        <div class="brand">
          <h1 class="hero-title" data-text="TUNA">TUNA</h1>
        </div>
      </header>

      <section class="mode-stage">
        <article
          id="mode-screen-tuner"
          class="mode-screen is-active"
          data-mode="tuner"
          role="tabpanel"
          aria-hidden="false"
        >
          <div class="mode-header">
            <div class="mode-title tuner-title">Chromatic Tuner</div>
          </div>

          <div id="tuna-field" class="tuna-field" aria-hidden="true"></div>

          <div class="tuner-stack">
            <div id="strobe-visualizer" class="strobe-tuner idle">
              <div id="tuna-field" class="tuna-field" aria-hidden="true"></div>
              <div id="reading">
                <div id="note"></div>
                <div id="cents"></div>
              </div>
            </div>

            <div id="status"></div>
          </div>

        </article>

        <article
          id="mode-screen-metronome"
          class="mode-screen"
          data-mode="metronome"
          role="tabpanel"
          aria-hidden="true"
        >
          <div class="mode-header">
            <div class="mode-title">Metronome</div>
          </div>

          <div class="metronome-panel">
            <div
              id="tempo-dial"
              class="tempo-dial"
              role="slider"
              aria-label="Tempo"
              aria-valuemin="40"
              aria-valuemax="220"
              aria-valuenow="120"
              tabindex="0"
            >
              <div class="metro-starburst" aria-hidden="true"></div>
              <div class="tempo-wheel"></div>
              <div class="tempo-ring">
                <div class="tempo-indicator"></div>
                <div class="tempo-center">
                  <div id="tempo-value" class="tempo-value">120</div>
                  <div class="tempo-label">BPM</div>
                </div>
              </div>
            </div>
            <div class="metro-controls">
              <button class="ghost-btn" type="button" data-action="decrease">-</button>
              <button class="primary-btn" type="button" data-action="toggle">Start</button>
              <button class="ghost-btn" type="button" data-action="increase">+</button>
            </div>
            <div class="metro-options">
              <div class="option-chip metro-option">
                <button id="metro-time-button" class="option-btn" type="button" aria-haspopup="menu" aria-expanded="false">
                  Time 4/4
                </button>
                <div id="metro-time-menu" class="option-menu" role="menu">
                  <button type="button" role="menuitem" data-value="no-accent">No Accent</button>
                  <button type="button" role="menuitem" data-value="4/4">4/4</button>
                  <button type="button" role="menuitem" data-value="3/4">3/4</button>
                  <button type="button" role="menuitem" data-value="6/8">6/8</button>
                </div>
              </div>
            </div>
          </div>
        </article>

        <article
          id="mode-screen-drum-machine"
          class="mode-screen"
          data-mode="drum-machine"
          role="tabpanel"
          aria-hidden="true"
        >
          <button id="drum-exit" class="drum-exit" type="button" aria-label="Exit fullscreen">
            X
          </button>
          <div class="mode-header">
            <div class="mode-title">Drum Machine</div>
            <button
              id="carousel-toggle"
              class="carousel-toggle drum-fullscreen-toggle"
              type="button"
              aria-label="Fullscreen"
              disabled
            >
              <span class="fullscreen-icon" aria-hidden="true"></span>
            </button>
          </div>

          <div class="drum-mock" data-signature="4/4">
            <div class="drum-rotator">
              <div class="drum-ui">
                <div class="drum-tempo">
                  <button class="ghost-btn" type="button" data-tempo="down">-</button>
                  <div>
                    <div id="drum-tempo-value" class="tempo-value">120</div>
                    <div class="tempo-label">BPM</div>
                  </div>
                  <button class="ghost-btn" type="button" data-tempo="up">+</button>
                </div>
                <div class="drum-beat-picker">
                  <button
                    id="drum-beat-button"
                    class="ghost-btn drum-random"
                    type="button"
                    aria-haspopup="menu"
                    aria-expanded="false"
                  >
                    Beat
                  </button>
                  <div id="drum-beat-menu" class="option-menu" role="menu">
                    <button type="button" role="menuitem" data-beat="rock">Rock</button>
                    <button type="button" role="menuitem" data-beat="shuffle">Shuffle</button>
                    <button type="button" role="menuitem" data-beat="disco">Disco</button>
                    <button type="button" role="menuitem" data-beat="half-time">Half-Time</button>
                    <button type="button" role="menuitem" data-beat="breakbeat">Breakbeat</button>
                    <button type="button" role="menuitem" data-beat="afrobeat">Afrobeat</button>
                    <button type="button" role="menuitem" data-beat="minimal">Minimal</button>
                  </div>
                </div>
                <div class="drum-beat-picker">
                  <button
                    id="drum-kit-button"
                    class="ghost-btn drum-random"
                    type="button"
                    aria-haspopup="menu"
                    aria-expanded="false"
                  >
                    Kit: <span id="drum-kit-label">Rock</span>
                  </button>
                  <div id="drum-kit-menu" class="option-menu" role="menu">
                    <button type="button" role="menuitem" data-kit="rock">Rock Drums</button>
                    <button type="button" role="menuitem" data-kit="electro">Electro Drum Machine</button>
                    <button type="button" role="menuitem" data-kit="house">House Drums</button>
                    <button type="button" role="menuitem" data-kit="lofi">Lo-Fi Pocket</button>
                    <button type="button" role="menuitem" data-kit="latin">Latin Percussion</button>
                  </div>
                </div>
                <button id="drum-play-toggle" class="primary-btn drum-play" type="button">Play</button>
              </div>

              <div class="drum-grids">
                <div class="drum-playhead" aria-hidden="true"></div>
                <div class="drum-grid" data-signature="4/4">
                  <div class="drum-row" data-voice="kick">
                    <div class="drum-label">Kick</div>
                    <div class="drum-steps">
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                    </div>
                  </div>
                  <div class="drum-row" data-voice="snare">
                    <div class="drum-label">Snare</div>
                    <div class="drum-steps">
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                    </div>
                  </div>
                  <div class="drum-row" data-voice="hat">
                    <div class="drum-label">Hat</div>
                    <div class="drum-steps">
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step is-on" type="button"></button>
                      <button class="step" type="button"></button>
                    </div>
                  </div>
                  <div class="drum-row" data-voice="perc">
                    <div class="drum-label">Perc</div>
                    <div class="drum-steps">
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                      <button class="step" type="button"></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </article>
      </section>

      <div class="carousel">
        <div class="mode-dots" role="tablist" aria-label="Mode dots">
          <button class="mode-dot is-active" role="tab" aria-selected="true" aria-controls="mode-screen-tuner" data-mode="tuner" aria-label="Chromatic Tuner" type="button"></button>
          <button class="mode-dot" role="tab" aria-selected="false" aria-controls="mode-screen-metronome" data-mode="metronome" aria-label="Metronome" type="button"></button>
          <button class="mode-dot" role="tab" aria-selected="false" aria-controls="mode-screen-drum-machine" data-mode="drum-machine" aria-label="Drum Machine" type="button"></button>
        </div>
      </div>

      <button id="carousel-show" class="carousel-show" type="button" aria-hidden="true">
        Show modes
      </button>
    </main>

    <script>
      (() => {
        const contexts = new Set();
        const wrapContext = (Original) => {
          if (!Original) return Original;
          const Wrapped = function (...args) {
            const ctx = new Original(...args);
            contexts.add(ctx);
            return ctx;
          };
          Wrapped.prototype = Original.prototype;
          return Wrapped;
        };
        if (window.AudioContext) {
          window.AudioContext = wrapContext(window.AudioContext);
        }
        if (window.webkitAudioContext) {
          window.webkitAudioContext = wrapContext(window.webkitAudioContext);
        }
        const resumeAll = () => {
          contexts.forEach((ctx) => {
            if (ctx.state === "suspended") {
              ctx.resume().catch(() => {});
            }
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            gain.gain.value = 0;
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.01);
          });
          window.removeEventListener("touchstart", resumeAll);
          window.removeEventListener("pointerdown", resumeAll);
        };
        window.addEventListener("touchstart", resumeAll, { passive: true });
        window.addEventListener("pointerdown", resumeAll, { passive: true });
      })();
    </script>
    <script type="module" src="./assets/app.js"></script>
  </body>
</html>
