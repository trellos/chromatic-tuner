{
  "version": 3,
  "sources": ["../../src/main.ts"],
  "sourcesContent": ["const startButton = document.getElementById(\"start\") as HTMLButtonElement | null;\r\nconst statusEl = document.getElementById(\"status\");\r\nconst noteEl = document.getElementById(\"note\");\r\nconst centsEl = document.getElementById(\"cents\");\r\n\r\nfunction setStatus(msg: string) {\r\n  if (statusEl) statusEl.textContent = msg;\r\n}\r\n\r\nfunction setReading(note: string | null, cents: string | null) {\r\n  if (noteEl) noteEl.textContent = note ?? \"\";\r\n  if (centsEl) centsEl.textContent = cents ?? \"\";\r\n}\r\n\r\nsetStatus(\"Idle\");\r\nsetReading(null, null);\r\n\r\nlet audioContext: AudioContext | null = null;\r\nlet micStream: MediaStream | null = null;\r\nlet workletNode: AudioWorkletNode | null = null;\r\n\r\nasync function startAudio() {\r\n  setStatus(\"Requesting microphone permission\u2026\");\r\n\r\n  micStream = await navigator.mediaDevices.getUserMedia({\r\n    audio: {\r\n      echoCancellation: false,\r\n      noiseSuppression: false,\r\n      autoGainControl: false\r\n    }\r\n  });\r\n\r\n  setStatus(\"Creating AudioContext\u2026\");\r\n  audioContext = new AudioContext({ latencyHint: \"interactive\" });\r\n  await audioContext.resume();\r\n\r\n  setStatus(\"Loading worklet module\u2026\");\r\n  try {\r\n    await audioContext.audioWorklet.addModule(\"/assets/worklet.js\");\r\n  } catch (e) {\r\n    console.error(\"addModule failed\", e);\r\n    setStatus(\"Error: addModule() failed. Check console + /assets/worklet.js\");\r\n    throw e;\r\n  }\r\n\r\n  setStatus(\"Creating audio graph\u2026\");\r\n  const source = audioContext.createMediaStreamSource(micStream);\r\n\r\n  workletNode = new AudioWorkletNode(audioContext, \"passthrough\");\r\n\r\n  workletNode.port.onmessage = (ev) => {\r\n    const data = ev.data as any;\r\n    if (data?.type === \"worklet-ready\") {\r\n      setStatus(`Worklet running. sampleRate=${data.sampleRate}`);\r\n    } else {\r\n      setStatus(`Worklet message: ${JSON.stringify(data)}`);\r\n    }\r\n  };\r\n\r\n  // Connect mic -> worklet. (No need to connect to destination for analysis.)\r\n  source.connect(workletNode);\r\n\r\n  // Keep output disconnected for now to avoid feedback.\r\n  // If you ever need to ensure processing continues, we can connect to a GainNode(0).\r\n}\r\n\r\nstartButton?.addEventListener(\"click\", async () => {\r\n  startButton.disabled = true;\r\n  setReading(null, null);\r\n\r\n  try {\r\n    await startAudio();\r\n  } catch (err) {\r\n    console.error(err);\r\n    setStatus(\r\n      err instanceof Error ? `Error: ${err.message}` : \"Error starting audio\"\r\n    );\r\n    startButton.disabled = false;\r\n  }\r\n});\r\n"],
  "mappings": ";;;;;;AAAA;AAAA;AAAA,QAAM,cAAc,SAAS,eAAe,OAAO;AACnD,QAAM,WAAW,SAAS,eAAe,QAAQ;AACjD,QAAM,SAAS,SAAS,eAAe,MAAM;AAC7C,QAAM,UAAU,SAAS,eAAe,OAAO;AAE/C,aAAS,UAAU,KAAa;AAC9B,UAAI,SAAU,UAAS,cAAc;AAAA,IACvC;AAEA,aAAS,WAAW,MAAqB,OAAsB;AAC7D,UAAI,OAAQ,QAAO,cAAc,QAAQ;AACzC,UAAI,QAAS,SAAQ,cAAc,SAAS;AAAA,IAC9C;AAEA,cAAU,MAAM;AAChB,eAAW,MAAM,IAAI;AAErB,QAAI,eAAoC;AACxC,QAAI,YAAgC;AACpC,QAAI,cAAuC;AAE3C,mBAAe,aAAa;AAC1B,gBAAU,wCAAmC;AAE7C,kBAAY,MAAM,UAAU,aAAa,aAAa;AAAA,QACpD,OAAO;AAAA,UACL,kBAAkB;AAAA,UAClB,kBAAkB;AAAA,UAClB,iBAAiB;AAAA,QACnB;AAAA,MACF,CAAC;AAED,gBAAU,6BAAwB;AAClC,qBAAe,IAAI,aAAa,EAAE,aAAa,cAAc,CAAC;AAC9D,YAAM,aAAa,OAAO;AAE1B,gBAAU,8BAAyB;AACnC,UAAI;AACF,cAAM,aAAa,aAAa,UAAU,oBAAoB;AAAA,MAChE,SAAS,GAAG;AACV,gBAAQ,MAAM,oBAAoB,CAAC;AACnC,kBAAU,+DAA+D;AACzE,cAAM;AAAA,MACR;AAEA,gBAAU,4BAAuB;AACjC,YAAM,SAAS,aAAa,wBAAwB,SAAS;AAE7D,oBAAc,IAAI,iBAAiB,cAAc,aAAa;AAE9D,kBAAY,KAAK,YAAY,CAAC,OAAO;AACnC,cAAM,OAAO,GAAG;AAChB,YAAI,MAAM,SAAS,iBAAiB;AAClC,oBAAU,+BAA+B,KAAK,UAAU,EAAE;AAAA,QAC5D,OAAO;AACL,oBAAU,oBAAoB,KAAK,UAAU,IAAI,CAAC,EAAE;AAAA,QACtD;AAAA,MACF;AAGA,aAAO,QAAQ,WAAW;AAAA,IAI5B;AAEA,iBAAa,iBAAiB,SAAS,YAAY;AACjD,kBAAY,WAAW;AACvB,iBAAW,MAAM,IAAI;AAErB,UAAI;AACF,cAAM,WAAW;AAAA,MACnB,SAAS,KAAK;AACZ,gBAAQ,MAAM,GAAG;AACjB;AAAA,UACE,eAAe,QAAQ,UAAU,IAAI,OAAO,KAAK;AAAA,QACnD;AACA,oBAAY,WAAW;AAAA,MACzB;AAAA,IACF,CAAC;AAAA;AAAA;",
  "names": []
}
